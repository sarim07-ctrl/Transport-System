/**************** FILE 1: data.h ****************/
#ifndef DATA_H
#define DATA_H

#include <QString>

// Structure to store bus and driver information
struct Bus {
    QString driverName;   // Name of the driver
    QString license;      // Driving license number
    QString busNumber;    // Unique bus number
    QString busType;      // AC / Non-AC
    QString route;        // Bus route (e.g., Islamabad - Lahore)
    QString timing;       // Departure and arrival timing
    int totalSeats;       // Total seats on bus
    int bookedSeats;      // Seats already booked
};

// Global array of buses and current count
extern Bus buses[20];
extern int busCount;

#endif

/**************** FILE 2: mainwindow.h ****************/
#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <QMainWindow>
#include "passengerwindow.h"
#include "driverwindow.h"

// MainWindow serves as the central menu for the transport system
class MainWindow : public QMainWindow {
    Q_OBJECT
public:
    MainWindow(QWidget *parent = nullptr); // Constructor to setup UI
};

#endif

/**************** FILE 3: mainwindow.cpp ****************/
#include "mainwindow.h"
#include "ui_mainwindow.h"
#include <QMessageBox>

// Constructor: sets up UI elements and loads initial sample data
MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    loadSampleData(); // Preload some buses for testing
}

MainWindow::~MainWindow()
{
    delete ui; // Clean up UI memory
}

// Loads sample buses and populates combobox for selection
void MainWindow::loadSampleData()
{
    vehicleCount = 3;

    vehicles[0] = {"Bus1", "Islamabad-Lahore", 40, 5};
    vehicles[1] = {"Bus2", "Islamabad-Peshawar", 35, 10};
    vehicles[2] = {"Van1", "Islamabad-Rawalpindi", 15, 3};

    // Add bus names to combobox for passengers to select
    for (int i = 0; i < vehicleCount; i++) {
        ui->comboBox->addItem(QString::fromStdString(vehicles[i].name));
    }
}

// Displays available buses and seats in a message box
void MainWindow::on_viewButton_clicked()
{
    QString info;
    for (int i = 0; i < vehicleCount; i++) {
        info += QString::fromStdString(vehicles[i].name) + " - " +
                QString::fromStdString(vehicles[i].route) +
                "\nAvailable Seats: " +
                QString::number(vehicles[i].totalSeats - vehicles[i].bookedSeats) +
                "\n\n";
    }

    QMessageBox::information(this, "Available Routes", info);
}

// Handles booking a seat for the selected bus
void MainWindow::on_bookButton_clicked()
{
    int index = ui->comboBox->currentIndex();

    if (vehicles[index].bookedSeats < vehicles[index].totalSeats) {
        vehicles[index].bookedSeats++;
        QMessageBox::information(this, "Success", "Seat booked successfully!");
    } else {
        QMessageBox::warning(this, "Error", "No seats available!");
    }
}

// Handles canceling a seat for the selected bus
void MainWindow::on_cancelButton_clicked()
{
    int index = ui->comboBox->currentIndex();

    if (vehicles[index].bookedSeats > 0) {
        vehicles[index].bookedSeats--;
        QMessageBox::information(this, "Cancelled", "Booking cancelled.");
    } else {
        QMessageBox::warning(this, "Error", "No booking to cancel.");
    }
}

/**************** FILE 4: mainwindow_customUI.cpp ****************/
#include "mainwindow.h"
#include <QPushButton>

// Main menu window with Passenger and Driver buttons
MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
{
    setWindowTitle("Transport System");
    setFixedSize(300, 200); // Fixed window size

    // Create buttons
    QPushButton *passengerBtn = new QPushButton("Passenger", this);
    QPushButton *driverBtn = new QPushButton("Driver", this);

    passengerBtn->setGeometry(80, 50, 140, 40); // Set position & size
    driverBtn->setGeometry(80, 110, 140, 40);

    // Connect buttons to open new windows
    connect(passengerBtn, &QPushButton::clicked, this, [](){
        PassengerWindow *p = new PassengerWindow();
        p->show(); // Open passenger booking window
    });

    connect(driverBtn, &QPushButton::clicked, this, [](){
        DriverWindow *d = new DriverWindow();
        d->show(); // Open driver registration window
    });
}

/**************** FILE 5: driverwindow.h ****************/
#ifndef DRIVERWINDOW_H
#define DRIVERWINDOW_H

#include <QWidget>

// Driver registration window
class DriverWindow : public QWidget {
    Q_OBJECT
public:
    DriverWindow(QWidget *parent = nullptr);

private slots:
    void submitBus(); // Slot for submit button (optional)
};

#endif

/**************** FILE 6: driverwindow.cpp ****************/
#include "driverwindow.h"
#include "data.h"
#include <QVBoxLayout>
#include <QLineEdit>
#include <QSpinBox>
#include <QPushButton>
#include <QMessageBox>

// Constructor: creates input fields and submit button
DriverWindow::DriverWindow(QWidget *parent)
    : QWidget(parent)
{
    setWindowTitle("Driver Registration");

    QVBoxLayout *layout = new QVBoxLayout(this);

    // Input fields for driver & bus details
    QLineEdit *name = new QLineEdit();
    QLineEdit *license = new QLineEdit();
    QLineEdit *busNo = new QLineEdit();
    QLineEdit *type = new QLineEdit();
    QLineEdit *route = new QLineEdit();
    QLineEdit *time = new QLineEdit();
    QSpinBox *seats = new QSpinBox();
    QPushButton *submit = new QPushButton("Submit");

    // Placeholder text for guidance
    name->setPlaceholderText("Driver Name");
    license->setPlaceholderText("License Number");
    busNo->setPlaceholderText("Bus Number");
    type->setPlaceholderText("Bus Type (AC / Non-AC)");
    route->setPlaceholderText("Route");
    time->setPlaceholderText("Timing (8:00 - 12:00)");
    seats->setMaximum(60); // Max seats allowed

    // Add widgets to layout
    layout->addWidget(name);
    layout->addWidget(license);
    layout->addWidget(busNo);
    layout->addWidget(type);
    layout->addWidget(route);
    layout->addWidget(time);
    layout->addWidget(seats);
    layout->addWidget(submit);

    // Connect submit button to lambda for saving bus
    connect(submit, &QPushButton::clicked, this, [=]() {
        if (busCount >= 20) return; // Prevent overflow

        buses[busCount++] = {
            name->text(),
            license->text(),
            busNo->text(),
            type->text(),
            route->text(),
            time->text(),
            seats->value(),
            0 // Initially no seats booked
        };

        QMessageBox::information(this, "Success", "Bus Registered Successfully");
        close(); // Close window after registration
    });
}

/**************** FILE 7: passengerwindow.h ****************/
#ifndef PASSENGERWINDOW_H
#define PASSENGERWINDOW_H

#include <QWidget>

// Passenger booking window
class PassengerWindow : public QWidget {
    Q_OBJECT
public:
    PassengerWindow(QWidget *parent = nullptr);

private slots:
    void bookSeat(); // Slot to handle seat booking
};

#endif

/**************** FILE 8: passengerwindow.cpp ****************/
#include "passengerwindow.h"
#include "data.h"
#include <QVBoxLayout>
#include <QListWidget>
#include <QPushButton>
#include <QMessageBox>

QListWidget *list; // Displays list of available buses

// Constructor: sets up passenger booking UI
PassengerWindow::PassengerWindow(QWidget *parent)
    : QWidget(parent)
{
    setWindowTitle("Passenger Booking");

    QVBoxLayout *layout = new QVBoxLayout(this);
    list = new QListWidget();
    QPushButton *book = new QPushButton("Book Seat");

    // Populate list with bus info
    for (int i = 0; i < busCount; i++) {
        list->addItem(
            buses[i].busNumber + " | " +
            buses[i].route + " | Seats: " +
            QString::number(buses[i].totalSeats - buses[i].bookedSeats)
        );
    }

    layout->addWidget(list);
    layout->addWidget(book);

    // Connect booking button to slot
    connect(book, &QPushButton::clicked, this, &PassengerWindow::bookSeat);
}

// Slot: Book seat for selected bus
void PassengerWindow::bookSeat() {
    int row = list->currentRow();
    if (row < 0) return; // No selection made

    if (buses[row].bookedSeats < buses[row].totalSeats) {
        buses[row].bookedSeats++; // Increment booked seats
        QMessageBox::information(this, "Booked", "Seat Booked Successfully");
    } else {
        QMessageBox::warning(this, "Full", "No Seats Available");
    }
}

/**************** FILE 9: main.cpp ****************/
#include "mainwindow.h"
#include <QApplication>

// Entry point for the Qt application
int main(int argc, char *argv[])
{
    QApplication a(argc, argv); // Create Qt application
    MainWindow w;               // Create main menu window
    w.show();                    // Display window
    return a.exec();             // Start event loop
}


